<div class="grid w-dvw h-dvh bg-slate-200 grid-cols-1 grid-rows-[auto_1fr_auto]">
  <!-- Navigation -->
  <nav class="bg-slate-100 px-3 py-4 flex justify-between items-center">
    <div class="flex items-center gap-3">
      <button type="button" class="border-none outline-none" (click)="handleExit()">
        <lucide-icon [img]="icons.exit" class="size-8 text-pink-700" />
      </button>
      <h1 class="text-2xl">Sala: {{ roomId() }}</h1>
    </div>
    <p class="text-nowrap">Conectados: {{ onlineCount() }}</p>
  </nav>
  <!-- Chat -->
  <div #scrollContainer class="flex flex-col gap-1 overflow-y-auto my-2">
    @let history = chatHistory(); @for (message of history; track $index) { @if (message.type ===
    "SYSTEM_MESSAGE") {
    <div
      class="mx-auto max-w-[80%] text-center bg-slate-300 text-slate-950 text-xs px-2 py-1 rounded-md shadow-2xs"
    >
      {{ message.content }} - {{ message.timestamp | date : 'dd/MM/yy H:mm' }}
    </div>
    } @else {
    <div class="w-full px-3 py-1">
      <div class="flex items-center gap-2">
        <span [style.color]="message.temporalId! | stringColor" class="font-bold">{{
          message.username
        }}</span>
        <small class="text-slate-700">{{ message.timestamp | date : 'dd/MM/yy H:mm' }}</small>
      </div>
      @for (text of message.content; track $index) {
      <p class="whitespace-break-spaces wrap-break-word text-wrap">{{ text }}</p>
      }
    </div>
    } }
  </div>
  <!-- Input -->
  <form class="bg-slate-100 w-full flex gap-2 p-3" (submit)="handleSendMessage($event)">
    <textarea
      class="field-sizing-content max-h-32 p-3 w-full resize-none rounded-xl border border-slate-300 outline-none bg-slate-200"
      placeholder="Escriba un mensaje...."
      (keydown.enter)="handleSendMessage($event)"
      (keydown.shift.enter)="(null)"
      [field]="messageForm.content"
    ></textarea>
    <button
      type="submit"
      class="px-4 py-2 rounded-xl outline-none transition-colors duration-300 text-pink-50 bg-pink-700 hover:bg-pink-900 disabled:bg-slate-400! disabled:text-slate-950/50! disabled:cursor-not-allowed"
      [disabled]="messageForm().invalid()"
    >
      Enviar
    </button>
  </form>
</div>
